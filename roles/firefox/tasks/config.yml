---
# tasks list to configure firefox
- name: Firefox | Configure
  when: ansible_facts['system'] == "Linux"
  block:
  - name: Firefox | Configure | Deploy ESR Policy
    become: true
    ansible.builtin.template:
      src: templates/policies.json.j2
      dest: /usr/share/firefox-esr/distribution/policies.json
      owner: root
      group: root
      mode: 0644

  - name: Firefox | Configure | Set firefox_default_profile_dir Fact
    ansible.builtin.set_fact:
      firefox_default_profile_dir: "{{ kali_user_details.home }}/.mozilla/firefox/user.default-esr"

  - name: Firefox | Configure | Check If Profile Exists
    ansible.builtin.stat:
      path: "{{ firefox_default_profile_dir }}"
    register: firefox_profile

  - name: Firefox | Configure | Create Default Profile
    ansible.builtin.command: "firefox-esr -CreateProfile \"user {{ firefox_default_profile_dir }}\""
    when: not firefox_profile.stat.exists

  - name: Firefox | Configure | Copy ini Files
    ansible.builtin.copy:
      src: "files/{{ item }}"
      dest: "{{ kali_user_details.home }}/.mozilla/firefox/{{ item }}"
      mode: 0600
    loop:
      - installs.ini
      - profiles.ini

  - name: Firefox | Configure | Copy user.js From quieter-firefox
    ansible.builtin.copy:
      src: files/user.js
      dest: "{{ firefox_default_profile_dir }}/user.js"
      mode: 0600
